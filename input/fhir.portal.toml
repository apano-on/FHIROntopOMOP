title="FHIR/OMOP VKG Demo"

[defaultTab]
query="""
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT * WHERE {
    # ?x a fhir:DomainResource .
    ?x a fhir:Patient .
	?x fhir:Resource.id [fhir:value ?id] 
} 
LIMIT 100
"""

[[tabGroups]]

name="Example Queries"

[[tabGroups.tabs]]

name="Patient"
query="""
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT * WHERE {
    ?sub a fhir:Patient .
    ?sub fhir:Patient.gender    [   fhir:value ?gender      ] .
    ?sub fhir:Patient.birthDate [   fhir:value ?birthDate   ] .
} 
LIMIT 10
"""

[[tabGroups.tabs]]
name="DESCRIBE a Patient"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xml: <http://www.w3.org/XML/1998/namespace>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

DESCRIBE ?p ?o
WHERE {
    ?p a fhir:Patient ; fhir:Resource.id [ fhir:value "392776922" ]  .
  	?p ?e ?o .
}
"""

[[tabGroups.tabs]]

name="Condition"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT DISTINCT ?patient ?code ?system ?display WHERE {
    ?condition a fhir:Condition .
 	?condition	fhir:Condition.subject	?patient .
	?condition	fhir:Condition.code	[
	    fhir:CodeableConcept.coding [ 
            fhir:Coding.code    [ fhir:value    ?code    ];  
            fhir:Coding.system  [ fhir:value    ?system  ]; 
            fhir:Coding.display [ fhir:value    ?display ] 
	    ] 
	].
	FILTER (str(?code) = '129721000119106' || str(?code) = '140031000119103' || str(?code) = '145681000119101' || str(?code) = '14669001' || str(?code) = '200118004' || str(?code) = '236428007' || str(?code) = '236429004' || str(?code) = '236432001' || str(?code) = '307309005' || str(?code) = '36225005' || str(?code) = '423533009' || str(?code) = '429224003' || str(?code) = '429489008' || str(?code) = '430535006' || str(?code) = '722095005' || str(?code) = '722096006' || str(?code) = '722278006'  )
	FILTER (str(?system) = 'SNOMED' )
}
LIMIT 100
"""

[[tabGroups.tabs]]
name="Condition - Count"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT DISTINCT ?code ?system ?display (count(?patient) as ?count) WHERE {
    ?condition a fhir:Condition .
 	?condition	fhir:Condition.subject	?patient .
	?condition	fhir:Condition.code	[
	    fhir:CodeableConcept.coding [ 
	        fhir:Coding.code	[ fhir:value	?code    ];  
	        fhir:Coding.system	[ fhir:value	?system  ]; 
	        fhir:Coding.display	[ fhir:value	?display ] 
        ] 
    ].
	FILTER (str(?code) = '129721000119106' || str(?code) = '140031000119103' || str(?code) = '145681000119101' || str(?code) = '14669001' || str(?code) = '200118004' || str(?code) = '236428007' || str(?code) = '236429004' || str(?code) = '236432001' || str(?code) = '307309005' || str(?code) = '36225005' || str(?code) = '423533009' || str(?code) = '429224003' || str(?code) = '429489008' || str(?code) = '430535006' || str(?code) = '722095005' || str(?code) = '722096006' || str(?code) = '722278006'  )
	FILTER (str(?system) = 'SNOMED' )
} GROUP BY ?code ?system ?display ORDER BY ?count
"""

[[tabGroups.tabs]]
name="Condition"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT DISTINCT ?patient ?code ?system ?display WHERE {
{
    ?condition a fhir:Condition .
 	?condition	fhir:Condition.subject	?patient .
	?condition	fhir:Condition.code	[
	    fhir:CodeableConcept.coding [
	        fhir:Coding.code	[ fhir:value	?code  ];  
	        fhir:Coding.system	[ fhir:value	?system  ]; 
	        fhir:Coding.display	[ fhir:value	?display  ] 
        ] 
    ].
	FILTER (str(?code) = '1532007' || str(?code) = '195655000' || str(?code) = '195656004' || str(?code) = '195657008' || str(?code) = '195658003' || str(?code) = '195659006' || str(?code) = '195660001' || str(?code) = '195662009' || str(?code) = '232399005' || str(?code) = '232400003' || str(?code) = '363746003' || str(?code) = '40766000' || str(?code) = '43878008' || str(?code) = '58031004' || str(?code) = 'J02.0' || str(?code) = 'J02.8' || str(?code) = 'J02.9'  )
	FILTER (str(?system) = 'SNOMED' || str(?system) = 'ICD10CM' )
}
UNION
{
 	?condition a fhir:Condition .
    ?condition	fhir:Condition.subject	?patient .
	?condition	fhir:Condition.code	[
	    fhir:CodeableConcept.coding [ 
	        fhir:Coding.code	[ fhir:value	?code  ];  
	        fhir:Coding.system	[ fhir:value	?system  ]; 
	        fhir:Coding.display	[ fhir:value	?display  ] 
        ] 
    ].	
    FILTER (str(?code) = '10629271000119107' || str(?code) = '17741008' || str(?code) = '195666007' || str(?code) = '195668008' || str(?code) = '195669000' || str(?code) = '195670004' || str(?code) = '195671000' || str(?code) = '195672007' || str(?code) = '195673002' || str(?code) = '195676005' || str(?code) = '195677001' || str(?code) = '302911003' || str(?code) = 'J03.00' || str(?code) = 'J03.01' || str(?code) = 'J03.80' || str(?code) = 'J03.81' || str(?code) = 'J03.90' || str(?code) = 'J03.91'  )
	FILTER (str(?system) = 'SNOMED' || str(?system) = 'ICD10CM' )
}
}
"""

[[tabGroups.tabs]]
name="Practitioner"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT DISTINCT * WHERE {
    ?p a   fhir:Practitioner .
	OPTIONAL {?p  fhir:Resource.id                [ fhir:value ?id ]  .}
	OPTIONAL {?p  fhir:Practitioner.identifier    [ fhir:value ?identifier ] }
	OPTIONAL {?p  fhir:Practitioner.name          [ fhir:value ?name ]  .}
	OPTIONAL {?p  fhir:Practitioner.gender        ?gender  . }
	OPTIONAL {?p  fhir:Practitioner.birthDate     [ fhir:value ?birth_date ] . }                               
	OPTIONAL {?p  fhir:Practitioner.qualification [ fhir:Practitioner.qualification.identifier [ fhir:Identifier.value [ fhir:value ?qualification ] ] ]  .}
}
LIMIT 100
"""
[[tabGroups.tabs]]
name="Procedure"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

DESCRIBE ?p ?o WHERE {
    ?p a   fhir:Procedure .
	?p  fhir:Resource.id  [ fhir:value "330854196" ]  .
    ?p ?e ?o
}
"""

[[tabGroups.tabs]]
name="Encounter"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

DESCRIBE ?p ?o WHERE {
    ?p a   fhir:Encounter .
	?p  fhir:Resource.id  [ fhir:value "541" ]  .
  ?p ?e ?o
}
"""

[[tabGroups.tabs]]
name="ConceptMap (subsumes)"
query="""
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT * WHERE {
	?map a fhir:ConceptMap ;
	    fhir:ConceptMap.sourceUri ?source ;
	    fhir:ConceptMap.targetUri ?target ;
	    fhir:ConceptMap.group.element.target.equivalence [fhir:value "subsumes"] .
	?source fhir:CodeableConcept.coding [  fhir:Coding.code    [ fhir:value ?source_code ] ;
                                           fhir:Coding.display [ fhir:value ?source_name ]  ;
                                           fhir:Coding.system  [ fhir:value ?source_system ]  ; ] ;
		    fhir:CodeableConcept.text   [ fhir:value  ?source_text]  .
	?target fhir:CodeableConcept.coding [  fhir:Coding.code    [ fhir:value ?target_code ] ;
                                           fhir:Coding.display [ fhir:value ?target_name ]  ;
                                           fhir:Coding.system  [ fhir:value ?target_system ]  ; ] ;
		    fhir:CodeableConcept.text   [ fhir:value  ?target_text]  .
    FILTER(?source != ?target)
    FILTER(?source_system != ?target_system) 
} 
LIMIT 100
"""

[[tabGroups.tabs]]
name="Distinct concepts for observations"
query="""
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>

SELECT DISTINCT ?concept_id ?code ?system ?display
WHERE {
?ob a fhir:Observation ;
    fhir:Observation.subject ?patient ;
    fhir:Observation.code	?concept_id .
    ?concept_id    fhir:CodeableConcept.coding [
        fhir:Coding.code    [ fhir:value    ?code    ];        
        fhir:Coding.system  [ fhir:value    ?system  ];
        fhir:Coding.display [ fhir:value    ?display ];        
    ] 
} 
LIMIT 100
"""

[[tabGroups]]

name="Evaluation Queries"

[[tabGroups.tabs]]
name="QUERY 1"
query="""
#--
#--Query domain: Encounter and Demographics
#--Query result: Male patients with inpatient admissions lasting >= 5 days

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX w5: <http://hl7.org/fhir/w5#>
PREFIX ofn:<http://www.ontotext.com/sparql/functions/>

SELECT  distinct ?patient ?gender ?type ?start ?end ?diff
WHERE {	
  ?e a fhir:Encounter .  
  ?e fhir:Encounter.period  [ 
      	fhir:Period.start [ fhir:value ?start ]  ;
        fhir:Period.end   [ fhir:value ?end ] ] . 
  ?e fhir:Encounter.subject [ fhir:link ?patient ] .
  ?e fhir:Encounter.class [fhir:CodeableConcept.coding [fhir:Coding.code [fhir:value ?type] ] ].
  ?patient a fhir:Patient ;
	 fhir:Patient.gender    [   fhir:value ?gender      ] ;
	 fhir:Patient.birthDate [   fhir:value ?birthDate   ] .
  FILTER (?gender = 'male')
  # FILTER (?type = 'IMP')
  BIND (ofn:daysBetween(?start, ?end) as ?diff)
  # FILTER (?diff >= "2"^^xsd:integer)
} 
LIMIT 100

# SQL

# SELECT p.person_id, p.gender_concept_id, vo.visit_concept_id, 
# 	visit_start_datetime, visit_end_datetime
# 	FROM omop.visit_occurrence vo JOIN omop.person p ON vo.person_id 
# 		= p.person_id
# 	WHERE vo.visit_concept_id = 9201
# 		and p.gender_concept_id = 8507
# 		and DATE_PART('day', vo.visit_end_datetime - 
# 			vo.visit_start_datetime) >= 5
"""

[[tabGroups.tabs]]
name="QUERY 2"
query="""
# --QUERY 2
# --Query domain: Conditions
# --Query result: Patients with Alzheimer’s disease 
# --Concept set: OMOP standard code for Alzheimer’s Disease (378419) including all descendants 

PREFIX fhir: <http://hl7.org/fhir/> 
PREFIX owl: <http://www.w3.org/2002/07/owl#> 
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
PREFIX sct: <http://snomed.info/id/> 
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
SELECT distinct ?patient ?code ?cond_date
WHERE {
	?cond fhir:Condition.subject / fhir:link ?patient .
  	?cond fhir:Condition.code ?cond_code .
	?cond fhir:Condition.onsetDateTime / fhir:value ?cond_date .
  	?cond_code fhir:CodeableConcept.coding [  fhir:Coding.code    [ fhir:value ?code ] ;
                                           fhir:Coding.display [ fhir:value ?name ]  ;
                                           fhir:Coding.system  [ fhir:value ?system ]  ; ] .
	FILTER (?system = 'SNOMED') 
  FILTER(?code = '443491000000105' || ?code = '443781000000102' || ?code = '443541000000101' || ?code = '419261000000107' || ?code = '97751000119108' || ?code = '698955006' || ?code = '698954005' || ?code = '142811000119104' || ?code = '142001000119106' || ?code = '141991000119109' || ?code = '105421000119105' || ?code = '1581000119101' || ?code = '79341000119107' || ?code = '192803007' || ?code = '192802002' || ?code = '192162002' || ?code = '192161009' || ?code = '134423002' || ?code = '134422007' || ?code = '142011000119109' || ?code = '16219201000119101' || ?code = '722600006' || ?code = '66108005' || ?code = '65096006' || ?code = '6475002' || ?code = '416975007' || ?code = '416780008' || ?code = '55009008' || ?code = '54502004' || ?code = '4817008' || ?code = '26852004' || ?code = '230280008' || ?code = '230269008' || ?code = '230268000' || ?code = '230267005' || ?code = '230266001' || ?code = '230265002' || ?code = '10532003' || ?code = '429161000124103' || ?code = '26929004')
}

# SQL
# 
# SELECT distinct co.person_id, co.condition_concept_id, 
# 	co.condition_start_date
# 	FROM omop.condition_occurrence co
# 	WHERE co.condition_concept_id IN (378419,762578,3170377,3176418,3177168,3179057,3184947,4019705,4043241,4043242,4043243,4043244,4043377,4043379,4097384,4167839,4182539,4204688,4218017,4220313,4277444,4277746,4278830,36716558,37117145,37395572,43021816,43530664,44782432,44782726,44782727,44782940,44782941,44784643)
"""

[[tabGroups.tabs]]
name="QUERY 3"
query="""
#--QUERY 3
#--Query domain: Procedures
#--Query result: Patients who delivered a baby 
#--Concept set: OMOP standard code for Delivery procedure (4128030) including all descendants. Note that there were several terms in this set using the “OPCS4” vocabulary, which does not appear to be supported by FHIR. Thus, those codes do not appear in the SPARQL version of the query.

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX fhir: <http://hl7.org/fhir/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX w5: <http://hl7.org/fhir/w5#>

SELECT distinct ?patient ?proccode ?procdate
WHERE {
	?proc fhir:Procedure.subject / fhir:link ?patient .
  	?proc fhir:Procedure.code ?proccode .
	?proc fhir:Procedure.performedDateTime / fhir:value ?procdate .
    ?proccode fhir:CodeableConcept.coding [  fhir:Coding.code    [ fhir:value ?code ] ;
                                           fhir:Coding.display [ fhir:value ?name ]  ;
                                           fhir:Coding.system  [ fhir:value ?system ]  ; ] .
   FILTER(
     (?system='CPT4' && (?code='59899' || ?code='59898' || ?code='59856' || ?code='59855' || ?code='59851' || ?code='59850' || ?code='59622' || ?code='59620' || ?code='59618' || ?code='59614' || ?code='59612' || ?code='59610' || ?code='59525' || ?code='59515' || ?code='59514' || ?code='59510' || ?code='59414' || ?code='59410' || ?code='59409' || ?code='59400' || ?code='59300' || ?code='58611'))
     ||
     (?system='ICD10CM' && (?code='10D18Z9' || ?code='10D17Z9' || ?code='10E0XZZ' || ?code='10D28ZZ' || ?code='10D27ZZ' || ?code='10D18ZZ' || ?code='10D17ZZ' || ?code='10D07Z8' || ?code='10D07Z7' || ?code='10D07Z6' || ?code='10D07Z5' || ?code='10D07Z4' || ?code='10D07Z3' || ?code='10D00Z2' || ?code='10D00Z1' || ?code='10D00Z0' || ?code='10D24ZZ' || ?code='10D20ZZ'))     
    ||
     (?system='ICD9CM' && (?code='73' || ?code='74.99' || ?code='74.4' || ?code='74.3' || ?code='73.99' || ?code='73.93' || ?code='73.9' || ?code='73.8' || ?code='73.59' || ?code='73.3' || ?code='73.2' || ?code='73.1' || ?code='73.09' || ?code='73.0' || ?code='72.8' || ?code='72.79' || ?code='72.54' || ?code='72.52' || ?code='72.39' || ?code='72.29' || ?code='72'))
     ||
     (?system='SNOMED' &&  (?code='709004006' || ?code='893721000000103' || ?code='700000006' || ?code='699999008' || ?code='450798003' || ?code='450484007' || ?code='450483001' || ?code='736118004' || ?code='736026009' || ?code='736020003' || ?code='736018001' || ?code='734276001' || ?code='734275002' || ?code='384730009' || ?code='788180009' || ?code='22633006' || ?code='71166009' || ?code='85548006' || ?code='85403009' || ?code='387711001' || ?code='75928003' || ?code='384729004' || ?code='69422002' || ?code='69162008' || ?code='65243006' || ?code='63407004' || ?code='62508004' || ?code='4504004' || ?code='40792007' || ?code='40704000' || ?code='38479009' || ?code='58705005' || ?code='408819007' || ?code='90438006' || ?code='359943008' || ?code='89346004' || ?code='89849000' || ?code='359940006' || ?code='89053004' || ?code='40219000' || ?code='84195007' || ?code='72492007' || ?code='417121007' || ?code='57271003' || ?code='5556001' || ?code='56620000' || ?code='54973000' || ?code='315308008' || ?code='61586001' || ?code='275168001' || ?code='275169009' || ?code='48204000' || ?code='274130007' || ?code='45718005' || ?code='416055001' || ?code='41059002' || ?code='30476003' || ?code='265639000' || ?code='265640003' || ?code='33807004' || ?code='306727001' || ?code='236994008' || ?code='236989008' || ?code='236987005' || ?code='236982004' || ?code='236991000' || ?code='236974004' || ?code='236973005' || ?code='236992007' || ?code='236985002' || ?code='236984003' || ?code='236981006' || ?code='236976002' || ?code='236975003' || ?code='288042004' || ?code='288194000' || ?code='288193006' || ?code='287977004' || ?code='302384005' || ?code='302383004' || ?code='302382009' || ?code='29613008' || ?code='28860009' || ?code='28542003' || ?code='25296001' || ?code='26313002' || ?code='25828002' || ?code='18625004' || ?code='17860005' || ?code='177174003' || ?code='177168003' || ?code='177164001' || ?code='177162002' || ?code='177161009' || ?code='177141003' || ?code='177175002' || ?code='177173009' || ?code='177167008' || ?code='177158008' || ?code='177152009' || ?code='177143000' || ?code='177142005' || ?code='177170007' || ?code='177176001' || ?code='177157003' || ?code='177185001' || ?code='177181005' || ?code='177179008' || ?code='177184002' || ?code='177180006' || ?code='177212000' || ?code='177204008' || ?code='177203002' || ?code='16819009' || ?code='15413009' || ?code='237311001' || ?code='236990004' || ?code='236988000' || ?code='236986001' || ?code='236983009' || ?code='236980007' || ?code='236978001' || ?code='236977006' || ?code='14119008' || ?code='10745001' || ?code='19390001' || ?code='11466000' || ?code='1147971000000109' || ?code='1147961000000102' || ?code='1147951000000100'))
)
} 
#LIMIT 100

# SQL
#
# SELECT distinct po.person_id, po.procedure_concept_id, 
#	po.procedure_datetime
#	FROM omop.procedure_occurrence po
#	WHERE po.procedure_concept_id IN (1781151,1781152,2004702,2004707,2004710,2004724,2004726,2004730,2004731,2004744,2004746,2004747,2004748,2004751,2004765,2004767,2004768,2004771,2004783,2004788,2004789,2004802,2110237,2110303,2110307,2110308,2110309,2110311,2110315,2110316,2110317,2110318,2110319,2110320,2110321,2110322,2110323,2110324,2110331,2110332,2110334,2110335,2110341,2110342,2784564,2784565,2784566,2784567,2784568,2784569,2784570,2784571,2784572,2784573,2784574,2784575,2784576,2784578,3657302,3662128,3662129,4015701,4023797,4027926,4030877,4032761,4032762,4032764,4032766,4032767,4032768,4032769,4034145,4035778,4056129,4069968,4069969,4070222,4071505,4071507,4071629,4071630,4071632,4073422,4073424,4073438,4075160,4075161,4075165,4075168,4075169,4075170,4075171,4075182,4075187,4075188,4075189,4075190,4075191,4075735,4088084,4093774,4096145,4100410,4102595,4103850,4106406,4114636,4114637,4120986,4121758,4121923,4121924,4125788,4127248,4127249,4127250,4127251,4127252,4127253,4128030,4128031,4128032,4130319,4130320,4130321,4130323,4137400,4141265,4142513,4143647,4147974,4165077,4166247,4167018,4167089,4167497,4170152,4173513,4189205,4191809,4202559,4204679,4208862,4210037,4211824,4213387,4217642,4223536,4223638,4228344,4230533,4231702,4232028,4234421,4234710,4237340,4240325,4244672,4248119,4250441,4261498,4266683,4272812,4278225,4290098,4290245,4293034,4294827,4300392,4309795,4311671,4324549,4331179,37312440,40551541,42535816,42535817,42536952,42536954,42536960,42537021,42872492,42872493,42872805,43018344,43018345,44513729,44513733,44513736,44513740,44513743,44513745,44513746,44513747,44513752,44513756,44513761,44513763,44513765,44513771,44784096,44784097,44809684,46270991)
"""

[[tabGroups.tabs]]
name="QUERY 4"
query="""
#--QUERY 4
#--Query domain: Drugs
#--Query result: Patients taking an antidepressant
#--Concept set: Descendants of the ATC classification “Antidepressant” (OMOP concept ID 21604686), limited to OMOP standard RxNorm codes. 
#--QUERY 4
#--Query domain: Drugs
#--Query result: Patients taking an antidepressant
#--Concept set: Descendants of the ATC classification “Antidepressant” (OMOP concept ID 21604686), limited to OMOP standard RxNorm codes. 

prefix owl: <http://www.w3.org/2002/07/owl#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix sct: <http://snomed.info/id/> 
prefix xsd: <http://www.w3.org/2001/XMLSchema#> 
PREFIX fhir: <http://hl7.org/fhir/>

SELECT DISTINCT * #?patient ?medcode ?meddate
WHERE {
  ?med fhir:MedicationStatement.subject / fhir:link ?patient .
  ?med fhir:MedicationStatement.medicationCodeableConcept ?med_concept. 
  ?concept fhir:CodeableConcept.coding [  fhir:Coding.code    / fhir:value ?med_code   ;
                                          fhir:Coding.display / fhir:value ?med_name   ;
                                          fhir:Coding.system  / fhir:value ?med_system ; ] .
  ?med fhir:MedicationStatement.effectiveDateTime / fhir:value ?med_date .
  FILTER (?med_system = 'RxNorm')
  FILTER (?med_code IN ('993503', '993505', '993511', '993518', '993520', '993528', '993536', '993537', '993550', '993552', '993567', '993569', '993681', '993683', '993541', '993542', '993545', '993557', '993559', '993564', '1232585', '1232591', '790264', '1435480', '790288', '1435483', '1874553', '790267', '1607617', '1607619', '1874559', '790290', '903873', '903875', '903879', '903881', '1738803', '1738804', '1738805', '1738806', '1738807', '1738808', '433888', '898697', '898701', '898704', '898706', '411805', '313581', '729931', '808744', '808748', '313583', '729932', '808751', '313585', '729929', '808753', '433854', '94', '1293411', '1293417', '1945210', '664854', '447003', '410503', '1424835', '1424836', '485513', '1293416', '1293413', '1293420', '1945212', '664855', '485514', '447004', '17698', '332362', '249964', '370853', '704', '329158', '439240', '429487', '336774', '331045', '565981', '755505', '104802', '201700', '330607', '248665', '438118', '413148', '439241', '429484', '439928', '429485', '328819', '565980', '104801', '201699', '439242', '429486', '370863', '379811', '379807', '856705', '875965', '856811', '856784', '856783', '201692', '856812', '856785', '856858', '856860', '856859', '856861', '856862', '856761', '856763', '856765', '856762', '856764', '856766', '856768', '856772', '856774', '856776', '856773', '856775', '856777', '856791', '875973', '856835', '856837', '875971', '856865', '201697', '856834', '201694', '856836', '856838', '856866', '856867', '856839', '875968', '856846', '856848', '875969', '856850', '856868', '201698', '856845', '201696', '856847', '856849', '856851', '856852', '856854', '856856', '856853', '856855', '856857', '370569', '92567', '370862', '370864', '379806', '379810', '370570', '379812', '92568', '92594', '368416', '722', '315363', '566587', '197363', '205696', '315364', '566594', '197364', '205703', '315365', '566597', '197365', '205706', '315366', '566600', '197366', '205709', '438914', '422766', '438915', '370575', '369517', '47111', '332625', '249157', '371071', '42347', '378354', '835488', '581648', '581652', '1232588', '491056', '891739', '993549', '993551', '993553', '993554', '993566', '993568', '993570', '993571', '993680', '993682', '993684', '993685', '993502', '993504', '993510', '993506', '993507', '993512', '993687', '993688', '993517', '993519', '993523', '993527', '993953', '993521', '993522', '993525', '993529', '993955', '993532', '993534', '993538', '993539', '993556', '993558', '993563', '993560', '993561', '993565', '1232584', '1232587', '1232592', '1232593', '993696', '993697', '993690', '993692', '993691', '993693', '378233', '94591', '19895', '332708', '246174', '332709', '563030', '246175', '102548', '333626', '563031', '246176', '102549', '371176', '369541', '371711', '251615', '251614', '2556', '331567', '575018', '565289', '645289', '730440', '283672', '284591', '153503', '330309', '574562', '309313', '261342', '329444', '573240', '564629', '540846', '645290', '730441', '200371', '213344', '108886', '540848', '631739', '631740', '329445', '573241', '573976', '645291', '730442', '309314', '213345', '226376', '393457', '389202', '645288', '730439', '374620', '364574', '371532', '368139', '368503', '540847', '2597', '330453', '429337', '371576', '857290', '857292', '857291', '857288', '857289', '892741', '2375709', '892744', '892742', '2375713', '892746', '857295', '857298', '857297', '857299', '857296', '894754', '2375714', '894756', '894755', '2375715', '894757', '894758', '2375716', '894760', '894759', '2375717', '894761', '857308', '857309', '857300', '857302', '857301', '857303', '857315', '857304', '857306', '857326', '857305', '857307', '894762', '2375718', '894764', '894763', '2375719', '894765', '371573', '371572', '366755', '757223', '371575', '2375710', '892745', '3247', '328208', '309671', '332978', '328209', '309672', '484937', '1099739', '1099740', '1099287', '1099289', '1099288', '1099290', '1099291', '1099293', '1099292', '1099294', '1099731', '1099732', '1099295', '1099297', '1099296', '1099298', '1099299', '1099301', '1099397', '1099300', '1099302', '1099398', '1099741', '1099742', '1099303', '1099305', '1099735', '1099304', '1099306', '1099315', '1099317', '1099316', '1099318', '438861', '371710', '371709', '369482', '385691', '734064', '790262', '1435476', '790265', '845104', '1435481', '845105', '803408', '790287', '1435482', '790289', '845106', '1435484', '845107', '803409', '790263', '1435477', '790266', '803407', '1874552', '1874554', '1874556', '1874557', '1874564', '1874566', '1607620', '1607621', '1874558', '1874560', '1874562', '1874563', '3332', '439249', '434276', '429389', '439252', '429391', '439253', '429390', '439251', '439250', '3634', '393237', '421926', '331849', '563761', '563759', '564729', '199461', '104810', '104808', '141939', '430629', '360909', '756289', '331850', '563762', '563760', '564730', '409812', '199462', '104811', '104809', '141940', '371958', '385696', '385694', '385692', '439936', '371959', '385697', '385695', '385693', '3638', '328242', '430460', '330430', '430463', '439208', '413146', '328244', '430462', '966786', '966789', '966787', '966791', '439210', '422765', '439256', '430461', '328245', '199944', '966792', '966794', '966793', '966795', '328246', '199945', '1000047', '1000049', '1000051', '1000048', '1000050', '1000052', '1000053', '1000055', '1000054', '1000056', '1000057', '1000059', '1000061', '1000058', '1000060', '1000062', '1000063', '1000065', '1000067', '1000064', '1000066', '1000068', '1000069', '1000071', '1000073', '1000070', '1000072', '1000074', '1000075', '1000077', '1000080', '1000076', '1000078', '1000081', '1000090', '1000092', '1000094', '1000091', '1000093', '1000095', '1000096', '1000098', '1000100', '1000097', '1000099', '1000101', '439209', '371962', '366189', '366188', '379135', '364213', '375040', '966790', '377691', '362334', '362333', '72625', '596925', '596927', '2200170', '596926', '596928', '483045', '542051', '596929', '596931', '2200176', '596930', '596932', '578710', '542055', '483420', '2200179', '1652065', '616402', '1652069', '596933', '615185', '2200182', '596934', '615186', '647112', '540628', '540631', '2200171', '1652066', '706256', '476260', '578712', '483044', '542050', '321988', '353398', '576381', '351285', '404420', '351044', '575972', '349332', '352272', '353383', '575973', '351250', '352273', '353382', '576370', '351249', '404408', '378734', '406125', '378695', '368571', '2119365', '2119377', '2119383', '2119381', '2119387', '2201623', '2201625', '4493', '315951', '566436', '647323', '799024', '310384', '205535', '647325', '799026', '313990', '261282', '647555', '334801', '252440', '803292', '803294', '803293', '803295', '315952', '563783', '575748', '647441', '799058', '433731', '310385', '104849', '647442', '799059', '248642', '352004', '647556', '541517', '541519', '541518', '541520', '334802', '252271', '315953', '563784', '310386', '104850', '330341', '574512', '313989', '261287', '541357', '452715', '406413', '336689', '252272', '334800', '564960', '151260', '151261', '1190110', '331559', '539701', '313995', '598032', '284196', '826097', '826100', '378618', '598031', '439755', '374650', '902713', '902715', '902714', '902716' 
# Adding all the codes would cause a "stackoverflow" exception of Ontop
#, '902717', '902719', '902718', '902720', '826102', '826104', '826103', '826105', '826096', '826099', '826098', '826101', '372231', '93904', '647324', '799025', '372232', '363958', '372233', '368226', '369487', '647554', '372241', '865143', '865146', '42355', '328269', '104848', '328268', '104847', '385706', '790408', '790880', '903872', '903874', '903876', '903877', '903884', '903885', '903878', '903880', '903882', '903883', '903886', '903888', '903887', '903889', '903890', '903892', '903891', '903893', '372256', '368436', '1309228', '1307704', '5691', '375848', '372465', '835592', '875868', '835595', '835594', '835593', '102550', '835596', '849893', '849894', '835581', '835583', '835582', '835584', '849895', '849896', '835563', '875847', '835565', '835587', '835564', '102551', '835566', '835585', '876058', '835586', '755463', '835567', '835569', '835580', '835568', '835570', '849897', '849898', '372466', '362692', '370680', '366227', '756959', '756960', '370679', '369550', '368818', '835590', '835597', '835591', '835598', '835588', '835599', '835589', '835600', '835576', '835578', '835577', '835579', '835571', '835573', '835572', '835574', '5979', '385699', '563765', '104816', '104815', '353559', '563034', '102553', '102552', '378802', '368912', '6011', '316104', '565984', '104837', '201708', '370712', '367720', '6465', '336737', '565181', '250722', '153133', '440993', '432740', '336738', '563035', '249706', '102554', '372625', '386034', '372626', '369535', '6646', '1298802', '1298803', '1298856', '1298858', '1298857', '1298859', '1298860', '1298862', '1298861', '1298863', '1298869', '1298871', '1298870', '1298872', '441169', '1298809', '1298810', '1298811', '1298812', '372717', '368900', '29434', '441196', '432443', '441197', '446248', '446247', '6929', '332225', '563767', '199484', '104819', '332546', '563768', '199485', '104820', '332226', '563769', '199774', '104821', '335219', '246179', '372912', '385701', '588250', '833133', '833137', '833135', '833139', '833140', '833142', '833141', '833143', '446519', '833148', '410840', '833147', '833149', '446521', '833145', '410839', '833144', '833146', '833107', '833134', '833138', '30031', '446552', '432773', '446553', '15996', '2049248', '2049253', '2049251', '2049256', '343091', '571764', '283406', '752869', '311725', '211322', '446508', '413727', '343092', '571765', '283407', '752870', '314111', '211323', '343213', '574379', '283485', '752871', '311726', '261135', '476810', '476809', '378442', '752868', '446509', '378384', '368602', '2049250', '2049254', '30121', '335233', '246588', '332243', '199487', '332244', '199488', '372943', '31565', '1098648', '1098650', '1098649', '1098651', '1098665', '1098667', '1098666', '1098668', '1098669', '1098671', '1098670', '1098672', '1098711', '1098712', '1098673', '1098675', '1098674', '1098676', '1098709', '1098710', '1098677', '1098679', '1098678', '1098680', '1098713', '1098714', '373012', '368306', '7394', '446735', '428270', '446736', '7500', '435402', '435401', '435403', '7531', '373300', '328868', '250682', '563770', '569943', '198045', '1100363', '209329', '199283', '104822', '328878', '1100364', '570075', '312036', '1100366', '209464', '335356', '250565', '328870', '563771', '583237', '569950', '317136', '1100384', '583239', '209339', '199406', '104823', '334812', '335357', '249835', '249570', '328875', '569961', '198046', '209350', '328876', '570002', '198047', '209391', '748775', '373124', '1100362', '583238', '366678', '373125', '1100365', '364778', '373126', '385702', '7674', '446959', '433701', '446960', '32937', '562789', '828445', '1738482', '1738484', '1738483', '211699', '1738486', '1738488', '562790', '828446', '1738490', '1738492', '312242', '213291', '1738494', '1738496', '1738495', '207349', '1738498', '1738500', '562791', '828448', '1738502', '1738504', '1738503', '207350', '1738506', '1738508', '562815', '828451', '1738510', '1738512', '1738511', '211700', '1738514', '1738516', '1738515', '541660', '1738518', '1738520', '1738519', '541662', '1738522', '1738524', '1738523', '541664', '1738526', '1738528', '1738527', '541666', '1738562', '1738564', '1430122', '1430128', '1430121', '1430125', '373245', '366082', '378925', '367670', '541659', '8123', '328543', '563779', '312347', '104836', '373308', '368101', '8886', '905167', '1036836', '905169', '905168', '141946', '905170', '905171', '1036890', '905173', '905172', '141945', '905174', '373665', '385703', '368076', '35242', '451347', '430603', '451352', '844903', '451353', '451348', '60842', '385582', '565294', '153515', '153516', '385583', '386056', '36437', '328670', '568875', '248098', '312938', '208149', '451487', '410584', '794947', '861063', '861065', '861064', '861066', '334494', '251201', '251200', '329212', '572455', '199990', '312940', '212233', '328671', '568885', '248097', '312941', '208161', '373867', '374622', '364573', '373868', '368413', '1801289', '993524', '993954', '2200168', '2200174', '2200175', '2200177', '2200178', '2200180', '2200181', '2200183', '38252', '335737', '252334', '374124', '38382', '452229', '410437', '452230', '10734', '378427', '452733', '378419', '328687', '250489', '427805', '563780', '313447', '104838', '343555', '251574', '452333', '452279', '427804', '430330', '374182', '369259', '10737', '335767', '413145', '439360', '411880', '336997', '251494', '376314', '370119', '898700', '856380', '875938', '856381', '141947', '856372', '856374', '875910', '856382', '104826', '856373', '856375', '856363', '856365', '1231897', '876027', '898699', '898702', '104825', '898703', '856364', '856366', '104824', '856368', '856370', '898705', '898707', '898708', '856369', '856371', '856376', '856378', '875911', '856383', '104827', '856377', '856379', '452327', '374183', '366526', '374184', '380863', '374185', '369258', '369442', '10834', '335793', '563776', '250033', '104829', '328763', '569311', '313496', '208645', '313497', '335794', '245372', '452392', '413885', '328764', '563777', '313498', '208646', '199820', '104830', '330525', '564378', '313499', '106834', '245373', '337000', '245374', '452393', '374238', '366266', '374239', '368621', '10898', '801411', '800465', '799965', '800291', '800030', '801572', '800360', '799986', '800090', '801603', '800137', '799890', '800315', '800893', '800206', '799911', '801628', '799943', '800162', '800338', '799863', '435493', '435492', '335805', '411840', '244158', '435495', '435494', '800234', '336850', '244156', '335806', '435488', '252434', '800184', '316872', '580313', '565619', '563038', '565620', '199906', '580315', '313525', '200972', '102560', '200973', '335807', '244157', '335808', '252435', '452461', '429638', '374258', '580314', '374259', '386231', '386234', '386233', '39786', '328798', '569497', '844871', '313580', '208848', '331427', '729930', '411816', '845052', '431753', '801848', '801849', '330822', '569498', '313582', '208849', '328799', '569499', '844817', '845053', '431737', '313584', '208850', '328800', '569500', '314277', '208851', '328801', '569502', '411815', '845051', '431754', '313586', '208853', '452534', '729928', '452535', '374285', '369178', '1086769', '1086770', '1086774', '1086772', '1086776', '1086777', '1086779', '1086778', '1086780', '1086783', '1086785', '1086784', '1086786', '1086771', '1086775', '11196', '452539', '432804', '452542', '413758', '452540', '844896', '335836', '563778', '250411', '104831', '452541', '452543', '374292', '385704', '1455099', '1439804', '1439843', '1790882', '1439808', '1439844', '1790886', '1439839', '1439841', '1790887', '1439840', '1439842', '1790888', '1439809', '1439836', '1790889', '1439810', '1439838', '1790890', '1439811', '1439825', '1790891', '1439812', '1439829', '1790892', '1439807', '1439826', '1790883', '1098682', '1098681', '2119391', '2119390', '2119389', '2119388', '833151', '833150', '763189', '763188', '1653470', '1086790', '1099646', '1653469', '1086789', '1099645'
  ))
}
LIMIT 100
"""

[[tabGroups.tabs]]
name="QUERY 5"
query="""
#--QUERY 5
#--Query domain: Measurement
#--Query result: Patients with an HbA1c >= 10%
#--Concept set: Three LOINC codes for A1c tests (OMOP concept IDs 3005673,3004410,3003309)

prefix owl: <http://www.w3.org/2002/07/owl#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix sct: <http://snomed.info/id/> 
prefix xsd: <http://www.w3.org/2001/XMLSchema#> 
PREFIX fhir: <http://hl7.org/fhir/>

SELECT ?patient ?code ?result ?testdate
WHERE {
	?meas fhir:Observation.subject / fhir:link ?patient .
	?meas fhir:Observation.code / fhir:CodeableConcept.coding [ 
    fhir:Coding.code / fhir:value ?code ;
	  fhir:Coding.system / fhir:value ?system ].
  ?meas fhir:Observation.valueQuantity / fhir:Quantity.value / fhir:value ?result .
  # ?meas fhir:Observation.effectiveDateTime / fhir:value ?testdate .
  ?meas fhir:Observation.effectivePeriod / fhir:Period.start / fhir:value ?testdate .
  FILTER(?system = 'LOINC') 
  FILTER(?code = '17856-6' || ?code = '4548-4' || ?code = '4549-2')
  FILTER(?result >= 10)
}
LIMIT 100

#SQL
#
#SELECT distinct mea.person_id, mea.measurement_concept_id, mea.value_as_number, mea.measurement_date
#	FROM omop.measurement mea
#	WHERE mea.measurement_concept_id in (3005673,3004410,3003309) and mea.value_as_number >= 10
#
"""
